<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Running Achilles on Your CDM • Achilles</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Running Achilles on Your CDM">
<meta property="og:description" content="Achilles">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Achilles</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/GettingStarted.html">Getting Started with Achilles</a>
    </li>
    <li>
      <a href="../articles/RunningAchilles.html">Running Achilles on Your CDM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Running Achilles on Your CDM</h1>
            
            <h4 data-toc-skip class="date">2023-05-11</h4>
      
      
      <div class="hidden name"><code>RunningAchilles.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this vignette we cover how to run the Achilles package on your
Common Data Model (CDM) database in order to characterize the dataset.
The characterizations can help you learn more about your dataset’s
features and limitations.</p>
<p>It is a best practice for all OHDSI sites to run Achilles on their
CDM datasets to ensure researchers can evaluate study feasibility and
contextualize study results.</p>
</div>
<div class="section level2">
<h2 id="general-approach">General Approach<a class="anchor" aria-label="anchor" href="#general-approach"></a>
</h2>
<p>The Achilles package consists of:</p>
<ol style="list-style-type: decimal">
<li>The <strong>achilles</strong> function runs a set of SQL scripts to
characterize the domains and concepts of the CDM.</li>
<li>The <strong>createIndices</strong> function creates table indices
for the achilles tables, which can help improve query performance.</li>
<li>The <strong>getAnalysisDetails</strong> function provides
descriptions about the full set of Achilles analyses.</li>
<li>The <strong>dropAllScratchTables</strong> function is useful only
for multi-threaded mode. It can clear any leftover staging tables.</li>
</ol>
<div class="section level3">
<h3 id="sql-only-mode">SQL Only Mode<a class="anchor" aria-label="anchor" href="#sql-only-mode"></a>
</h3>
<p>In most Achilles functions, you can specify
<code>sqlOnly = TRUE</code> in order to produce the SQL without
executing it, which can be useful if you’d like to examine the SQL
closely or debug something. The SQL files are stored in the
<code>outputFolder</code>.</p>
</div>
<div class="section level3">
<h3 id="logging">Logging<a class="anchor" aria-label="anchor" href="#logging"></a>
</h3>
<p>File and console logging is enabled across most Achilles functions.
The status of each step is logged into files in the
<code>outputFolder</code>. You can review the files in a common text
editor.</p>
</div>
<div class="section level3">
<h3 id="verbose-mode">Verbose Mode<a class="anchor" aria-label="anchor" href="#verbose-mode"></a>
</h3>
<p>The <code>verboseMode</code> parameter can be set to FALSE if you’d
like less details about the function execution to appear in the console.
Either way, all details are written to the log files. By default, this
is set to TRUE.</p>
</div>
<div class="section level3">
<h3 id="preparation-for-running-achilles">Preparation for running Achilles<a class="anchor" aria-label="anchor" href="#preparation-for-running-achilles"></a>
</h3>
<p>In order to run the package, you will need to determine if you’d like
the Achilles tables and staging tables to be stored in schemas that are
separate from your CDM’s schema (recommended), or within the same schema
as the CDM.</p>
<div class="section level4">
<h4 id="multi-threaded-vs-single-threaded">Multi-Threaded vs Single-Threaded<a class="anchor" aria-label="anchor" href="#multi-threaded-vs-single-threaded"></a>
</h4>
<p>As the <strong>achilles</strong> functions can run independently, we
have added a multi-threaded mode to allow for more than 1 SQL script to
execute at a time. This is particularly useful for massively parallel
processing (MPP) platforms such as Amazon Redshift and Microsoft PDW. It
may not be beneficial for traditional SQL platforms, so only use the
multi-threaded mode if confident it can be useful.</p>
<p>Further, while multiple threads can help performance in MPP
platforms, there can be diminishing returns as the cluster has a finite
number of concurrency slots to handle the queries. A rule of thumb: most
likely you should not use more than 10.</p>
<p>In the multi-threaded mode, all scripts produce permanent staging
tables, whereas in the single-threaded mode, the scripts produce
temporary staging tables. In both, the staging tables are merged to
produce the final Achilles tables.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="achilles-parameters-both-modes">Achilles Parameters (Both Modes)<a class="anchor" aria-label="anchor" href="#achilles-parameters-both-modes"></a>
</h2>
<p>The following sub-sections describe the optional parameters in
<strong>achilles</strong> that can be configured, regardless of whether
you run the function in single- or multi-threaded mode.</p>
<div class="section level3">
<h3 id="staging-table-prefix">Staging Table Prefix<a class="anchor" aria-label="anchor" href="#staging-table-prefix"></a>
</h3>
<p>To keep the staging tables organized, the <strong>achilles</strong>
function will use a table prefix of “tmpach” by default, but you can
choose a different one using the <code>tempAchillesPrefix</code>
parameter. This is useful for database platforms like Oracle, which
limit the length of table names.</p>
</div>
<div class="section level3">
<h3 id="source-name">Source Name<a class="anchor" aria-label="anchor" href="#source-name"></a>
</h3>
<p>The <code>sourceName</code> parameter is used to assign the name of
the dataset to the Achilles results. If you set this to
<code>NULL</code>, the <strong>achilles</strong> function will try to
obtain the source name from the CDM_SOURCE table.</p>
</div>
<div class="section level3">
<h3 id="create-table">Create Table<a class="anchor" aria-label="anchor" href="#create-table"></a>
</h3>
<p>The <code>createTable</code> parameter, when set to
<code>TRUE</code>, drops any existing Achilles results tables and builds
new ones. If set to <code>FALSE</code>, these tables will persist, and
the <strong>achilles</strong> function will just insert new data to
them.</p>
</div>
<div class="section level3">
<h3 id="limiting-the-analyses">Limiting the Analyses<a class="anchor" aria-label="anchor" href="#limiting-the-analyses"></a>
</h3>
<p>By default, the <strong>achilles</strong> function runs all default
analyses detailed in the <code>getAnalysisDetails</code> function.
However, it may be useful to focus on a subset of analyses rather than
running the whole set. This can be accomplished by specifying analysis
Ids in the <code>analysisIds</code> parameter.</p>
</div>
<div class="section level3">
<h3 id="cost-analyses">Cost Analyses<a class="anchor" aria-label="anchor" href="#cost-analyses"></a>
</h3>
<p>By default, the <strong>achilles</strong> function does not run
analyses on the COST table(s), as they can be very time-consuming, and
are not critical to most OHDSI studies. However, you can choose to run
these analyses by setting <code>runCostAnalysis</code> to
<code>TRUE</code>. The cost analyses are conditional on the CDM version.
If using CDM v5.0, then the older cost tables are queried. If using any
version after 5.0, the unified cost table is queried.</p>
</div>
<div class="section level3">
<h3 id="small-cell-count">Small Cell Count<a class="anchor" aria-label="anchor" href="#small-cell-count"></a>
</h3>
<p>To avoid patient identification, you can establish the minimum cell
size that should be kept in the Achilles tables. Cells with small counts
(less than or equal to the value of the <code>smallCellCount</code>
parameter) are deleted. By default, this is set to 5. Set to 0 for
complete summary without small cell count restrictions.</p>
</div>
<div class="section level3">
<h3 id="drop-scratch-tables">Drop Scratch Tables<a class="anchor" aria-label="anchor" href="#drop-scratch-tables"></a>
</h3>
<p><em>See the Post-Processing section to read about how to run this
step separately</em></p>
<p><em>This parameter is only necessary if running in multi-threaded
mode</em></p>
<p>The <code>dropScratchTables</code> parameter, if set to
<code>TRUE</code>, will drop all staging tables created during the
execution of <strong>achilles</strong> in multi-threaded mode.</p>
</div>
<div class="section level3">
<h3 id="create-indices">Create Indices<a class="anchor" aria-label="anchor" href="#create-indices"></a>
</h3>
<p><em>See the Post-Processing section to read about how to run this
step separately</em></p>
<p>The <code>createIndices</code> parameter, if set to
<code>TRUE</code>, will result in indices on the Achilles results tables
to be created in order to improve query performance.</p>
</div>
<div class="section level3">
<h3 id="return-value">Return Value<a class="anchor" aria-label="anchor" href="#return-value"></a>
</h3>
<p>When running <strong>achilles</strong>, the return value, if you
assign a variable to the function call, is a list object in which
metadata about the execution and all of the SQL scripts executed are
attributes. You can also run the function call without assigning a
variable to it, so that no values are printed or returned.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-achilles-single-threaded-mode">Running Achilles: Single-Threaded Mode<a class="anchor" aria-label="anchor" href="#running-achilles-single-threaded-mode"></a>
</h2>
<p>In single-threaded mode, there is no need to set a
<code>scratchDatabaseSchema</code>, as temporary tables will be
used.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">createConnectionDetails</span><span class="op">(</span>dbms <span class="op">=</span> <span class="st">"postgresql"</span>, </span>
<span>                                             server <span class="op">=</span> <span class="st">"localhost/synpuf"</span>, </span>
<span>                                             user <span class="op">=</span> <span class="st">"cdm_user"</span>, </span>
<span>                                             password <span class="op">=</span> <span class="st">"cdm_password"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/achilles.html">achilles</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>, </span>
<span>         cdmDatabaseSchema <span class="op">=</span> <span class="st">"cdm"</span>, </span>
<span>         resultsDatabaseSchema <span class="op">=</span> <span class="st">"results"</span>, </span>
<span>         outputFolder <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="running-achilles-multi-threaded-mode">Running Achilles: Multi-Threaded Mode<a class="anchor" aria-label="anchor" href="#running-achilles-multi-threaded-mode"></a>
</h2>
<p>In multi-threaded mode, you need to specify
<code>scratchDatabaseSchema</code> and use &gt; 1 for
<code>numThreads</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">createConnectionDetails</span><span class="op">(</span>dbms <span class="op">=</span> <span class="st">"postgresql"</span>, </span>
<span>                                             server <span class="op">=</span> <span class="st">"localhost/synpuf"</span>, </span>
<span>                                             user <span class="op">=</span> <span class="st">"cdm_user"</span>, </span>
<span>                                             password <span class="op">=</span> <span class="st">"cdm_password"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/achilles.html">achilles</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>, </span>
<span>         cdmDatabaseSchema <span class="op">=</span> <span class="st">"cdm"</span>, </span>
<span>         resultsDatabaseSchema <span class="op">=</span> <span class="st">"results"</span>, </span>
<span>         scratchDatabaseSchema <span class="op">=</span> <span class="st">"scratch"</span>, </span>
<span>         numThreads <span class="op">=</span> <span class="fl">5</span>,</span>
<span>         outputFolder <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="post-processing">Post-Processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h2>
<p>This section describes the usage of standalone functions for
post-processing that can be invoked if you did not use them in the
<strong>achilles</strong> function call.</p>
<div class="section level3">
<h3 id="creating-indices">Creating Indices<a class="anchor" aria-label="anchor" href="#creating-indices"></a>
</h3>
<p><em>Not supported by Amazon Redshift or IBM Netezza; function will
skip this step if using those platforms</em></p>
<p>To improve query performance of the Achilles results tables, run the
<strong>createIndices</strong> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">createConnectionDetails</span><span class="op">(</span>dbms <span class="op">=</span> <span class="st">"postgresql"</span>, </span>
<span>                                             server <span class="op">=</span> <span class="st">"localhost/synpuf"</span>, </span>
<span>                                             user <span class="op">=</span> <span class="st">"cdm_user"</span>, </span>
<span>                                             password <span class="op">=</span> <span class="st">"cdm_password"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/createIndices.html">createIndices</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>, </span>
<span>              resultsDatabaseSchema <span class="op">=</span> <span class="st">"results"</span>, </span>
<span>              outputFolder <span class="op">=</span> <span class="st">"output"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="dropping-all-staging-tables-multi-threaded-only">Dropping All Staging Tables (Multi-threaded only)<a class="anchor" aria-label="anchor" href="#dropping-all-staging-tables-multi-threaded-only"></a>
</h3>
<p>If the <strong>achilles</strong> execution has errors, or if you did
not enable this step in the call to these functions, use the
<code>dropAllScratchTables</code> function.</p>
<p>The <code>tableTypes</code> parameter can be used to specify which
batch of staging tables to drop (“achilles”).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">createConnectionDetails</span><span class="op">(</span>dbms <span class="op">=</span> <span class="st">"postgresql"</span>, </span>
<span>                                             server <span class="op">=</span> <span class="st">"localhost/synpuf"</span>, </span>
<span>                                             user <span class="op">=</span> <span class="st">"cdm_user"</span>, </span>
<span>                                             password <span class="op">=</span> <span class="st">"cdm_password"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/dropAllScratchTables.html">dropAllScratchTables</a></span><span class="op">(</span>connectionDetails <span class="op">=</span> <span class="va">connectionDetails</span>, </span>
<span>                     scratchDatabaseSchema <span class="op">=</span> <span class="st">"scratch"</span>, numThreads <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="acknowledgments">Acknowledgments<a class="anchor" aria-label="anchor" href="#acknowledgments"></a>
</h2>
<p>Considerable work has been dedicated to provide the
<code>Achilles</code> package.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/citation.html" class="external-link">citation</a></span><span class="op">(</span><span class="st">"Achilles"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; To cite package 'Achilles' in publications use:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   DeFalco F, Ryan P, Schuemie M, Huser V, Knoll C, Londhe A,</span></span>
<span><span class="co">#&gt;   Abdul-Basser T, Molinaro A (2023). _Achilles: Achilles Data Source</span></span>
<span><span class="co">#&gt;   Characterization_. R package version 1.7.1.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; A BibTeX entry for LaTeX users is</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   @Manual{,</span></span>
<span><span class="co">#&gt;     title = {Achilles: Achilles Data Source Characterization},</span></span>
<span><span class="co">#&gt;     author = {Frank DeFalco and Patrick Ryan and Martijn Schuemie and Vojtech Huser and Chris Knoll and Ajit Londhe and Taha Abdul-Basser and Anthony Molinaro},</span></span>
<span><span class="co">#&gt;     year = {2023},</span></span>
<span><span class="co">#&gt;     note = {R package version 1.7.1},</span></span>
<span><span class="co">#&gt;   }</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Frank DeFalco, Patrick Ryan, Martijn Schuemie, Vojtech Huser, Chris Knoll, Ajit Londhe, Taha Abdul-Basser, Anthony Molinaro.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
